(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;b=a.WebSharper=a.WebSharper||{};c=b.AspNetCore=b.AspNetCore||{};d=c.Tests=c.Tests||{};e=d.WebSocketClient=d.WebSocketClient||{};f=d.Website=d.Website||{};g=f.SomeRecord=f.SomeRecord||{};h=f.Client=f.Client||{};i=h.Task=h.Task||{};j=a.StartupCode$WebSharper_AspNetCore_Tests_DNC31$Website=a.StartupCode$WebSharper_AspNetCore_Tests_DNC31$Website||{};k=a.WebSharper$AspNetCore$Tests$DNC31_JsonDecoder=a.WebSharper$AspNetCore$Tests$DNC31_JsonDecoder||{};l=a.WebSharper$AspNetCore$Tests$DNC31_JsonEncoder=a.WebSharper$AspNetCore$Tests$DNC31_JsonEncoder||{};m=a.WebSharper$AspNetCore$Tests$DNC31_Templates=a.WebSharper$AspNetCore$Tests$DNC31_Templates||{};n=b&&b.UI;o=n&&n.Doc;p=b&&b.Concurrency;q=c&&c.WebSocket;r=q&&q.Client;s=r&&r.WithEncoding;t=a.JSON;u=a.IntelliFactory;v=u&&u.Runtime;w=b&&b.Remoting;x=w&&w.AjaxRemotingProvider;y=b&&b.Utils;z=b&&b.Arrays;A=a.jQuery;B=n&&n.Var$1;C=n&&n.Templating;D=C&&C.Runtime;E=D&&D.Server;F=E&&E.ProviderBuilder;G=E&&E.Handler;H=E&&E.TemplateInstance;I=n&&n.ListModel;J=b&&b.List;K=b&&b.ClientSideJson;L=K&&K.Provider;M=n&&n.Client;N=M&&M.Templates;e.WebSocketTest=function(O,P){var Q,R;function S(T){return T(function(U){var V;V=self.document.createTextNode(U+"\n");Q.elt.appendChild(V);});}Q=o.Element("pre",[],[]);p.Start((R=null,p.Delay(function(){return p.Bind(s.ConnectStateful(function(T){return t.stringify((l.j())(T));},function(T){return(k.j())(t.parse(T));},P,function(){var T;T=null;return p.Delay(function(){return p.Return([0,function(U){return function(V){var W;W=null;return p.Delay(function(){var X,Y,Z;return V.$==3?p.Return(U):V.$==2?p.Return(U):V.$==1?(S(function(_0){return _0("WebSocket connection error!");}),p.Return(U)):(X=V.$0,p.Combine(X.$==0?(((S(v.Curried3(function(_0,_1,_2){return _0("Response2 "+a.String(_1)+" (state: "+a.String(_2)+")");})))(X.$0))(U),p.Zero()):(Y=X.$0,(p.Start((Z=null,p.Delay(function(){(new x.New()).Send("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.WebSocketClient.printit:-1410224646",[Y]);return Y.length>1?((S(function(_0){return function(_1){return _0(y.toSafe(_1));};}))(Y),p.Zero()):p.Zero();})),null),p.Zero())),p.Delay(function(){return p.Return(U+1);})));});};}]);});}),function(T){var U,V;z.length((new x.New()).Sync("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.WebSocketClient.spiltWithNoAsync:-1362869456",[O]))>2?(U=z.get((new x.New()).Sync("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.WebSocketClient.spiltWithNoAsync:-1362869456",[O]),2),U==="Register"?T.Post({$:4,$0:O}):U==="Subscribe"?T.Post({$:6,$0:O}):U==="Tweet"?T.Post({$:5,$0:O}):U==="ReTweet"?T.Post({$:12,$0:O}):U==="Query"?T.Post({$:7,$0:O}):U==="QueryTag"?T.Post({$:8,$0:O}):U==="QueryAt"?T.Post({$:9,$0:O}):U==="Login"?T.Post({$:10,$0:O}):U==="Logout"?T.Post({$:11,$0:O}):(new x.New()).Send("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.WebSocketClient.printit:-1410224646",["Error"])):T.Post({$:2,$0:O});A.ajax((V={},V.url="/ws.txt",V.method="GET",V.success=function(W){return(S(function(X){return function(Y){return X(y.toSafe(Y));};}))(W);},V.error=function(W,X,Y){return(S(function(Z){return function(_0){return Z("KO: "+y.toSafe(_0)+".");};}))(Y);},V));return p.Zero();});})),null);return Q;};g.New=function(O){return{Name:O};};i.New=function(O,P){return{Name:O,Done:P};};h.Main$127$20=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Logout",O);};};h.Main$125$22=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Login",O);};};h.Main$123$21=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",QueryAt",O);};};h.Main$121$22=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",QueryTag",O);};};h.Main$119$19=function(O){return function(){e.WebSocketTest(h.username().Get()+", ,Query",O);};};h.Main$117$23=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Subscribe",O);};};h.Main$115$21=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",ReTweet",O);};};h.Main$112$19=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Tweet",O);};};h.Main$110$22=function(O){return function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Register",O);};};h.Main=function(O,P){var Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9;return(Q=(R=(S=(T=(new x.New()).Sync("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.Website.rpcToString:-242087931",[]),(B.Set(h.username(),T),e.WebSocketTest(h.username().Get(),P))),(U=(V=o.Async((W=null,p.Delay(function(){return p.Bind((new x.New()).Async("WebSharper.AspNetCore.Tests.DNC31:WebSharper.AspNetCore.Tests.Website.DoSomething:32829901",[]),function(_){return p.Return(o.Element("div",[],[o.TextNode(_.Name)]));});}))),(X=(Y=(Z=(_0=(_1=(_2=(_3=(_4=(_5=(_6=(_7=new F.New$1(),(_7.h.push({$:8,$0:"login",$1:h.Login()}),_7)),(_6.h.push(G.EventQ2(_6.k,"register",function(){return _6.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Register",P);})),_6)),(_5.h.push(G.EventQ2(_5.k,"tweet",function(){return _5.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Tweet",P);})),_5)),(_4.h.push(G.EventQ2(_4.k,"retweet",function(){return _4.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",ReTweet",P);})),_4)),(_3.h.push(G.EventQ2(_3.k,"subscribe",function(){return _3.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Subscribe",P);})),_3)),(_2.h.push(G.EventQ2(_2.k,"query",function(){return _2.i;},function(){e.WebSocketTest(h.username().Get()+", ,Query",P);})),_2)),(_1.h.push(G.EventQ2(_1.k,"querytag",function(){return _1.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",QueryTag",P);})),_1)),(_0.h.push(G.EventQ2(_0.k,"queryat",function(){return _0.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",QueryAt",P);})),_0)),(Z.h.push(G.EventQ2(Z.k,"getlogin",function(){return Z.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Login",P);})),Z)),(Y.h.push(G.EventQ2(Y.k,"logout",function(){return Y.i;},function(){e.WebSocketTest(h.username().Get()+","+h.Login().Get()+",Logout",P);})),Y)),(X.h.push({$:0,$0:"remotingtest",$1:V}),X))),(U.h.push({$:0,$0:"websockettest",$1:S}),U))),(R.h.push({$:1,$0:"aboutpagelink",$1:O}),R)),(_8=G.CompleteHoles(Q.k,Q.h,[["login",0]]),(_9=new H.New(_8[1],m.body(_8[0])),Q.i=_9,_9))).get_Doc();};h.username=function(){j.$cctor();return j.username;};h.Login=function(){j.$cctor();return j.Login;};h.NewTaskName=function(){j.$cctor();return j.NewTaskName;};h.Tasks=function(){j.$cctor();return j.Tasks;};j.$cctor=function(){j.$cctor=a.ignore;j.Tasks=I.Create(function(O){return O.Name;},J.ofArray([i.New("Have breakfast",B.Create$1(true)),i.New("Have lunch",B.Create$1(false))]));j.NewTaskName=B.Create$1("");j.Login=B.Create$1("");j.username=B.Create$1("");};k.j=function(){return k._v?k._v:k._v=(L.DecodeUnion(void 0,"type",[["int",[["$0","value",L.Id(),0]]],["string",[["$0","value",L.Id(),0]]]]))();};l.j=function(){return l._v?l._v:l._v=(L.EncodeUnion(void 0,{ret:12,logoutq:11,loginq:10,atq:9,tagq:8,subq:7,sub:6,twe:5,reg:4,mes3:3,mes4:2,"int":1,str:0},[["Request1",[["$0","str",L.EncodeArray(L.Id()),0]]],["Request2",[["$0","int",L.EncodeArray(L.Id()),0]]],["Request4",[["$0","mes4",L.Id(),0]]],["Request3",[["$0","mes3",L.Id(),0]]],["Register",[["$0","reg",L.Id(),0]]],["Tweet",[["$0","twe",L.Id(),0]]],["Subscribe",[["$0","sub",L.Id(),0]]],["SubQuery",[["$0","subq",L.Id(),0]]],["TagQuery",[["$0","tagq",L.Id(),0]]],["AtQuery",[["$0","atq",L.Id(),0]]],["LoginQuery",[["$0","loginq",L.Id(),0]]],["LogoutQuery",[["$0","logoutq",L.Id(),0]]],["ReTweet",[["$0","ret",L.Id(),0]]]]))();};m.body=function(O){N.LoadLocalTemplates("main");return O?N.NamedTemplate("main",{$:1,$0:"body"},O):void 0;};}(self));
